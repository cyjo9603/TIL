# 맵과 위크맵

# 맵

맵(Map)는 키가 있는 데이터를 저장한다는 점에서 객체와 유사하다. 다만 맵은 캐에 다양한 자료형을 허용한다.

맵에서는 다음과 같은 주요 메서드와 프로퍼티가 있다.

- `new Map()` : 맵 선언
- `map.set(key, vlaue)` : `key`를 이용해 `value`를 저장한다.
- `map.get(key)` : `key`에 해당하는 값을 반환한다. `key`가 존재하지 않으면 `undefined`를 반환한다.
- `map.has(key)` : `key`가 존재하면 `true`, 존재하지 않으면 `false`를 반환한다.
- `map.delete(key)` : `key`에 해당하는 값을 삭제한다.
- `map.clear()` : 맵 안의 모든 요소를 제거한다.
- `map.size` : 요소의 개수를 반환한다.

맵은 키로 객체또한 허용한다.

`map[key]`는 Map을 쓰는 바른 방법이 아니다. 사용할 수는 있지만 이 방법은 map을 일반 객체처럼 취급하기 때문에 여러 제약이 생긴다.

## 맵이 키를 비교하는 방식

맵은 SameValueZero라 불리는 알고리즘을 사용해 값의 등가 여부를 확인한다. 이 알고리즘은 일치 연산자 `===`와 거의 유사하지만, `NaN`과 `NaN`을 같다고 취급하는 것에서 일치 연산자와 차이가 있다. 따라서 맵에선 `NaN`도 키로 쓸 수 있다.

이 알고리즘은 수정하거나 커스터마이징 하는 것이 불가능하다.

## 체이닝

```jsx
map.set('1', 'str1').set(1, 'num1').set(true, 'bool1');
```

`map.set`을 호출할 때마다 맵 자신이 반환된다. 이를 이요하면 `map.set`을 체이닝 할 수 있다.

## 맵의 요소에 반복 작업하기

다음 세 가지 메서드를 사용해 맵의 각 요소에 반복 작업을 할 수 있다.

- `map.keys()` : 각 요소의 키를 모은 이터러블 객체를 반환한다.
- `map.values()` : 각 요소의 값을 모은 이터러블 객체를 반환한다.
- `map.entries()` : 요소의 `[key, value]`를 한 쌍으로 하는 이터러블 객체를 반환한다. 이 이터러블 객체는 `for...of`반복문의 기초로 쓰인다.

맵은 배열과 유사하게 내장 메서드 `forEach`도 지원한다.

맵은 값이 삽입된 순서대로 순회를 실시한다. 객체가 프로퍼티 순서를 기억하지 못하는 것과는 다르다.

# 위크맵

위크맵은 일반 맵과는 가비지 컬렉션의 관점에서 전혀 다른 양상을 보인다. 위크맵을 사용하면 키로 쓰인 객체가 가비지 컬렉션의 대상이 된다.

맵과 위크맵의 첫 번째 차이는 위크맵의 키는 반드시 객체여야 한다. 원시값은 위크맵의 키가 될 수 없다.

```jsx
let john = { name: 'John' };

const weakMap = new WeakMap();
weakMap.set(john, '...');

john = null; // 참조를 덮어씀
// john을 나타내는 객체는 이제 메모리에서 지워진다.
```

john을 나타내는 객체는 오로지 위크맵의 키로만 사용되고 있으므로, 참조를 덮어쓰게 되면 이 객체는 위크맵과 메모리에서 자동으로 삭제된다.

맵과 위크맵의 두 번째 차이는 위크맵은 반복 작업과 keys(), values(), entries() 메서드를 지원하지 않는다는 점이다. 따라서 위크맵에선 키나 값 전체를 얻는 게 불가능하다.

위크맵이 지원하는 메서드는 다음과 같다.

- `weakMap.get(key)`
- `weakMap.set(key, value)`
- `weakMap.delete(key)`
- `weakMap.has(key)`

### 참고

[JAVASCRIPT.INFO - 맵과 셋](https://ko.javascript.info/map-set)

[JAVASCRIPT.INFO - 위크맵과 위크셋](https://ko.javascript.info/weakmap-weakset)